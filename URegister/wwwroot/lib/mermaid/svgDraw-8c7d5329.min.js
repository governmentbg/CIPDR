import{G as k,A as v,l as f,H as N}from"./mermaid-d733041c.js";import{l as I}from"./line-b0ce4b23.js";let S=0;const O=function(t,e,i,a,n){function r(t){switch(t){case n.db.relationType.AGGREGATION:return"aggregation";case n.db.relationType.EXTENSION:return"extension";case n.db.relationType.COMPOSITION:return"composition";case n.db.relationType.DEPENDENCY:return"dependency";case n.db.relationType.LOLLIPOP:return"lollipop"}}e.points=e.points.filter(t=>!Number.isNaN(t.y));const d=e.points,s=I().x(function(t){return t.x}).y(function(t){return t.y}).curve(k),l=t.append("path").attr("d",s(d)).attr("id","edge"+S).attr("class","relation");let o="";a.arrowMarkerAbsolute&&(o=(o=(o=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")),1==i.relation.lineType&&l.attr("class","relation dashed-line"),10==i.relation.lineType&&l.attr("class","relation dotted-line"),"none"!==i.relation.type1&&l.attr("marker-start","url("+o+"#"+r(i.relation.type1)+"Start)"),"none"!==i.relation.type2&&l.attr("marker-end","url("+o+"#"+r(i.relation.type2)+"End)");var p,g=e.points.length,c=v.calcLabelPosition(e.points),h=c.x,c=c.y;let x,y,u,b;if(g%2!=0&&1<g&&(p=v.calcCardinalityPosition("none"!==i.relation.type1,e.points,e.points[0]),e=v.calcCardinalityPosition("none"!==i.relation.type2,e.points,e.points[g-1]),f.debug("cardinality_1_point "+JSON.stringify(p)),f.debug("cardinality_2_point "+JSON.stringify(e)),x=p.x,y=p.y,u=e.x,b=e.y),void 0!==i.title){const w=t.append("g").attr("class","classLabel"),m=w.append("text").attr("class","label").attr("x",h).attr("y",c).attr("fill","red").attr("text-anchor","middle").text(i.title);g=(window.label=m).node().getBBox();w.insert("rect",":first-child").attr("class","box").attr("x",g.x-a.padding/2).attr("y",g.y-a.padding/2).attr("width",g.width+a.padding).attr("height",g.height+a.padding)}f.info("Rendering relation "+JSON.stringify(i)),void 0!==i.relationTitle1&&"none"!==i.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",x).attr("y",y).attr("fill","black").attr("font-size","6").text(i.relationTitle1),void 0!==i.relationTitle2&&"none"!==i.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",u).attr("y",b).attr("fill","black").attr("font-size","6").text(i.relationTitle2),S++},P=function(t,e,i,a){f.debug("Rendering class ",e,i);const n=e.id,r={id:n,label:e.id,width:0,height:0},d=t.append("g").attr("id",a.db.lookUpDomId(n)).attr("class","classGroup");let s,l=(s=(e.link?d.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget):d).append("text").attr("y",i.textHeight+i.padding).attr("x",0),!0);e.annotations.forEach(function(t){const e=s.append("tspan").text("«"+t+"»");l||e.attr("dy",i.textHeight),l=!1});t=E(e);const o=s.append("tspan").text(t).attr("class","title"),p=(l||o.attr("dy",i.textHeight),s.node().getBBox().height),g=d.append("line").attr("x1",0).attr("y1",i.padding+p+i.dividerMargin/2).attr("y2",i.padding+p+i.dividerMargin/2),c=d.append("text").attr("x",i.padding).attr("y",p+i.dividerMargin+i.textHeight).attr("fill","white").attr("class","classText"),h=(l=!0,e.members.forEach(function(t){_(c,t,l,i),l=!1}),c.node().getBBox()),x=d.append("line").attr("x1",0).attr("y1",i.padding+p+i.dividerMargin+h.height).attr("y2",i.padding+p+i.dividerMargin+h.height),y=d.append("text").attr("x",i.padding).attr("y",p+2*i.dividerMargin+h.height+i.textHeight).attr("fill","white").attr("class","classText");l=!0,e.methods.forEach(function(t){_(y,t,l,i),l=!1});a=d.node().getBBox(),t=" ";0<e.cssClasses.length&&(t+=e.cssClasses.join(" "));const u=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",a.width+2*i.padding).attr("height",a.height+i.padding+.5*i.dividerMargin).attr("class",t).node().getBBox().width;return s.node().childNodes.forEach(function(t){t.setAttribute("x",(u-t.getBBox().width)/2)}),e.tooltip&&s.insert("title").text(e.tooltip),g.attr("x2",u),x.attr("x2",u),r.width=u,r.height=a.height+i.padding+.5*i.dividerMargin,r},E=function(t){let e=t.id;return t.type&&(e+="<"+t.type+">"),e},A=function(t,e,i,a){f.debug("Rendering note ",e,i);const n=e.id,r={id:n,text:e.text,width:0,height:0},d=t.append("g").attr("id",n).attr("class","classGroup");let s=d.append("text").attr("y",i.textHeight+i.padding).attr("x",0);const l=JSON.parse(`"${e.text}"`).split(`
`),o=(l.forEach(function(t){f.debug("Adding line: "+t),s.append("tspan").text(t).attr("class","title").attr("dy",i.textHeight)}),d.node().getBBox()),p=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",o.width+2*i.padding).attr("height",o.height+l.length*i.textHeight+i.padding+.5*i.dividerMargin).node().getBBox().width;return s.node().childNodes.forEach(function(t){t.setAttribute("x",(p-t.getBBox().width)/2)}),r.width=p,r.height=o.height+l.length*i.textHeight+i.padding+.5*i.dividerMargin,r},M=function(e){let i="",a="",n="",t="",r=e.substring(0,1),d=e.substring(e.length-1,e.length);r.match(/[#+~-]/)&&(t=r);var s=/[\s\w)~]/,l=(d.match(s)||(a=C(d)),""===t?0:1),o=""===a?e.length:e.length-1,l=(e=e.substring(l,o)).indexOf("("),o=e.indexOf(")");if(1<l&&l<o&&o<=e.length){var p=e.substring(0,l).trim();const g=e.substring(l+1,o);if(i=t+p+"("+N(g.trim())+")",o<e.length){let t=e.substring(o+1,o+2);""!==(n=""!==a||t.match(s)?e.substring(o+1).trim():(a=C(t),e.substring(o+2).trim()))&&(":"===n.charAt(0)&&(n=n.substring(1).trim()),n=" : "+N(n),i+=n)}}else i=t+N(e);return{displayText:i,cssStyle:a}},_=function(t,e,i,a){e=M(e);const n=t.append("tspan").attr("x",a.padding).text(e.displayText);""!==e.cssStyle&&n.attr("style",e.cssStyle),i||n.attr("dy",a.textHeight)},C=function(t){switch(t){case"*":return"font-style:italic;";case"$":return"text-decoration:underline;";default:return""}},R={getClassTitleString:E,drawClass:P,drawEdge:O,drawNote:A,parseMember:M};export{M as p,R as s};