import{G as curveBasis,A as utils,l as log,H as parseGenericTypes}from"./mermaid-f185fde2.js";import{l as line}from"./line-eb9172ee.js";let edgeCount=0;const drawEdge=function(t,e,i,a,n){function r(t){switch(t){case n.db.relationType.AGGREGATION:return"aggregation";case n.db.relationType.EXTENSION:return"extension";case n.db.relationType.COMPOSITION:return"composition";case n.db.relationType.DEPENDENCY:return"dependency";case n.db.relationType.LOLLIPOP:return"lollipop"}}e.points=e.points.filter(t=>!Number.isNaN(t.y));var s=e.points;const d=line().x(function(t){return t.x}).y(function(t){return t.y}).curve(curveBasis),l=t.append("path").attr("d",d(s)).attr("id","edge"+edgeCount).attr("class","relation");let o="";a.arrowMarkerAbsolute&&(o=(o=(o=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")),1==i.relation.lineType&&l.attr("class","relation dashed-line"),10==i.relation.lineType&&l.attr("class","relation dotted-line"),"none"!==i.relation.type1&&l.attr("marker-start","url("+o+"#"+r(i.relation.type1)+"Start)"),"none"!==i.relation.type2&&l.attr("marker-end","url("+o+"#"+r(i.relation.type2)+"End)");var g,s=e.points.length,p=utils.calcLabelPosition(e.points),c=p.x,p=p.y;let h,x,u,y;if(s%2!=0&&1<s&&(g=utils.calcCardinalityPosition("none"!==i.relation.type1,e.points,e.points[0]),e=utils.calcCardinalityPosition("none"!==i.relation.type2,e.points,e.points[s-1]),log.debug("cardinality_1_point "+JSON.stringify(g)),log.debug("cardinality_2_point "+JSON.stringify(e)),h=g.x,x=g.y,u=e.x,y=e.y),void 0!==i.title){const f=t.append("g").attr("class","classLabel"),w=f.append("text").attr("class","label").attr("x",c).attr("y",p).attr("fill","red").attr("text-anchor","middle").text(i.title);s=(window.label=w).node().getBBox();f.insert("rect",":first-child").attr("class","box").attr("x",s.x-a.padding/2).attr("y",s.y-a.padding/2).attr("width",s.width+a.padding).attr("height",s.height+a.padding)}if(log.info("Rendering relation "+JSON.stringify(i)),void 0!==i.relationTitle1&&"none"!==i.relationTitle1){const b=t.append("g").attr("class","cardinality");b.append("text").attr("class","type1").attr("x",h).attr("y",x).attr("fill","black").attr("font-size","6").text(i.relationTitle1)}if(void 0!==i.relationTitle2&&"none"!==i.relationTitle2){const T=t.append("g").attr("class","cardinality");T.append("text").attr("class","type2").attr("x",u).attr("y",y).attr("fill","black").attr("font-size","6").text(i.relationTitle2)}edgeCount++},drawClass=function(t,e,i,a){log.debug("Rendering class ",e,i);var n=e.id;const r={id:n,label:e.id,width:0,height:0},s=t.append("g").attr("id",a.db.lookUpDomId(n)).attr("class","classGroup");let d,l=(d=(e.link?s.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget):s).append("text").attr("y",i.textHeight+i.padding).attr("x",0),!0);e.annotations.forEach(function(t){const e=d.append("tspan").text("«"+t+"»");l||e.attr("dy",i.textHeight),l=!1});t=getClassTitleString(e);const o=d.append("tspan").text(t).attr("class","title");l||o.attr("dy",i.textHeight);a=d.node().getBBox().height;const g=s.append("line").attr("x1",0).attr("y1",i.padding+a+i.dividerMargin/2).attr("y2",i.padding+a+i.dividerMargin/2),p=s.append("text").attr("x",i.padding).attr("y",a+i.dividerMargin+i.textHeight).attr("fill","white").attr("class","classText");l=!0,e.members.forEach(function(t){addTspan(p,t,l,i),l=!1});n=p.node().getBBox();const c=s.append("line").attr("x1",0).attr("y1",i.padding+a+i.dividerMargin+n.height).attr("y2",i.padding+a+i.dividerMargin+n.height),h=s.append("text").attr("x",i.padding).attr("y",a+2*i.dividerMargin+n.height+i.textHeight).attr("fill","white").attr("class","classText");l=!0,e.methods.forEach(function(t){addTspan(h,t,l,i),l=!1});t=s.node().getBBox(),a=" ";0<e.cssClasses.length&&(a+=e.cssClasses.join(" "));const x=s.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",t.width+2*i.padding).attr("height",t.height+i.padding+.5*i.dividerMargin).attr("class",a),u=x.node().getBBox().width;return d.node().childNodes.forEach(function(t){t.setAttribute("x",(u-t.getBBox().width)/2)}),e.tooltip&&d.insert("title").text(e.tooltip),g.attr("x2",u),c.attr("x2",u),r.width=u,r.height=t.height+i.padding+.5*i.dividerMargin,r},getClassTitleString=function(t){let e=t.id;return t.type&&(e+="<"+t.type+">"),e},drawNote=function(t,e,i,a){log.debug("Rendering note ",e,i);var n=e.id;const r={id:n,text:e.text,width:0,height:0},s=t.append("g").attr("id",n).attr("class","classGroup");let d=s.append("text").attr("y",i.textHeight+i.padding).attr("x",0);const l=JSON.parse(`"${e.text}"`).split("\n");l.forEach(function(t){log.debug("Adding line: "+t),d.append("tspan").text(t).attr("class","title").attr("dy",i.textHeight)});t=s.node().getBBox();const o=s.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",t.width+2*i.padding).attr("height",t.height+l.length*i.textHeight+i.padding+.5*i.dividerMargin),g=o.node().getBBox().width;return d.node().childNodes.forEach(function(t){t.setAttribute("x",(g-t.getBBox().width)/2)}),r.width=g,r.height=t.height+l.length*i.textHeight+i.padding+.5*i.dividerMargin,r},parseMember=function(e){let i="",a="",n="",t="",r=e.substring(0,1),s=e.substring(e.length-1,e.length);r.match(/[#+~-]/)&&(t=r);var d=/[\s\w)~]/,l=(s.match(d)||(a=parseClassifier(s)),""===t?0:1),o=""===a?e.length:e.length-1,l=(e=e.substring(l,o)).indexOf("("),o=e.indexOf(")");if(1<l&&l<o&&o<=e.length){var g=e.substring(0,l).trim();const p=e.substring(l+1,o);if(i=t+g+"("+parseGenericTypes(p.trim())+")",o<e.length){let t=e.substring(o+1,o+2);""!==(n=""!==a||t.match(d)?e.substring(o+1).trim():(a=parseClassifier(t),e.substring(o+2).trim()))&&(":"===n.charAt(0)&&(n=n.substring(1).trim()),n=" : "+parseGenericTypes(n),i+=n)}}else i=t+parseGenericTypes(e);return{displayText:i,cssStyle:a}},addTspan=function(t,e,i,a){e=parseMember(e);const n=t.append("tspan").attr("x",a.padding).text(e.displayText);""!==e.cssStyle&&n.attr("style",e.cssStyle),i||n.attr("dy",a.textHeight)},parseClassifier=function(t){switch(t){case"*":return"font-style:italic;";case"$":return"text-decoration:underline;";default:return""}},svgDraw={getClassTitleString:getClassTitleString,drawClass:drawClass,drawEdge:drawEdge,drawNote:drawNote,parseMember:parseMember};export{parseMember as p,svgDraw as s};