import{l as x,q as N,c as w,aT as z,j as E,d as F,A as U,G as Q}from"./mermaid-d733041c.js";import{c as rt}from"./createText-98e4790d.js";import{p as V}from"./svgDraw-8c7d5329.js";import{l as it}from"./line-b0ce4b23.js";const nt=(r,t,e,a)=>{t.forEach(t=>{xt[t](r,e,a)})},lt=(t,r,e)=>{x.trace("Making markers for ",e),t.append("defs").append("marker").attr("id",r+"-extensionStart").attr("class","marker extension "+r).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id",r+"-extensionEnd").attr("class","marker extension "+r).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},ct=(t,r)=>{t.append("defs").append("marker").attr("id",r+"-compositionStart").attr("class","marker composition "+r).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",r+"-compositionEnd").attr("class","marker composition "+r).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},ht=(t,r)=>{t.append("defs").append("marker").attr("id",r+"-aggregationStart").attr("class","marker aggregation "+r).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",r+"-aggregationEnd").attr("class","marker aggregation "+r).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},ot=(t,r)=>{t.append("defs").append("marker").attr("id",r+"-dependencyStart").attr("class","marker dependency "+r).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id",r+"-dependencyEnd").attr("class","marker dependency "+r).attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},ft=(t,r)=>{t.append("defs").append("marker").attr("id",r+"-lollipopStart").attr("class","marker lollipop "+r).attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","white").attr("cx",6).attr("cy",7).attr("r",6)},dt=(t,r)=>{t.append("marker").attr("id",r+"-pointEnd").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",10).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",r+"-pointStart").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",0).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},pt=(t,r)=>{t.append("marker").attr("id",r+"-circleEnd").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),t.append("marker").attr("id",r+"-circleStart").attr("class","marker "+r).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},yt=(t,r)=>{t.append("marker").attr("id",r+"-crossEnd").attr("class","marker cross "+r).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),t.append("marker").attr("id",r+"-crossStart").attr("class","marker cross "+r).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},ut=(t,r)=>{t.append("defs").append("marker").attr("id",r+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},xt={extension:lt,composition:ct,aggregation:ht,dependency:ot,lollipop:ft,point:dt,circle:pt,cross:yt,barb:ut},Pt=nt;function gt(t,r){r&&t.attr("style",r)}function bt(t){const r=E(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),e=r.append("xhtml:div"),a=t.label,i=t.isNode?"nodeLabel":"edgeLabel";return e.html('<span class="'+i+'" '+(t.labelStyle?'style="'+t.labelStyle+'"':"")+">"+a+"</span>"),gt(e,t.labelStyle),e.style("display","inline-block"),e.style("white-space","nowrap"),e.attr("xmlns","http://www.w3.org/1999/xhtml"),r.node()}const wt=(t,r,e,a)=>{let i=t||"";if("object"==typeof i&&(i=i[0]),N(w().flowchart.htmlLabels))return i=i.replace(/\\n|\n/g,"<br />"),x.info("vertexText"+i),bt({isNode:a,label:z(i).replace(/fa[blrs]?:fa-[\w-]+/g,t=>`<i class='${t.replace(":"," ")}'></i>`),labelStyle:r.replace("fill:","color:")});{const n=document.createElementNS("http://www.w3.org/2000/svg","text");n.setAttribute("style",r.replace("color:","fill:"));let t=[];for(const s of t="string"==typeof i?i.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(i)?i:[]){const l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),l.setAttribute("dy","1em"),l.setAttribute("x","0"),e?l.setAttribute("class","title-row"):l.setAttribute("class","row"),l.textContent=s.trim(),n.appendChild(l)}return n}},I=wt,B=async(t,r,e,a)=>{let i;var n=r.useHtmlLabels||N(w().flowchart.htmlLabels);i=e||"node default";const s=t.insert("g").attr("class",i).attr("id",r.domId||r.id),l=s.insert("g").attr("class","label").attr("style",r.labelStyle);let d;d=void 0===r.labelText?"":"string"==typeof r.labelText?r.labelText:r.labelText[0];const o=l.node();let c,h=(c="markdown"===r.labelType?rt(l,F(z(d),w()),{useHtmlLabels:n,width:r.width||w().flowchart.wrappingWidth,classes:"markdown-node-label"}):o.appendChild(I(F(z(d),w()),r.labelStyle,!1,a))).getBBox();e=r.padding/2;if(N(w().flowchart.htmlLabels)){const p=c.children[0],g=E(c),y=p.getElementsByTagName("img");if(y){const x=""===d.replace(/<img[^>]*>/g,"").trim();await Promise.all([...y].map(e=>new Promise(r=>{function t(){var t;e.style.display="flex",e.style.flexDirection="column",x?(t=(w().fontSize?w():window.getComputedStyle(document.body)).fontSize,e.style.width=5*parseInt(t,10)+"px"):e.style.width="100%",r(e)}setTimeout(()=>{e.complete&&t()}),e.addEventListener("error",t),e.addEventListener("load",t)})))}h=p.getBoundingClientRect(),g.attr("width",h.width),g.attr("height",h.height)}return n?l.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"):l.attr("transform","translate(0, "+-h.height/2+")"),r.centerLabel&&l.attr("transform","translate("+-h.width/2+", "+-h.height/2+")"),l.insert("rect",":first-child"),{shapeSvg:s,bbox:h,halfPadding:e,label:l}},v=(t,r)=>{r=r.node().getBBox();t.width=r.width,t.height=r.height};function _(t,r,e,a){return t.insert("polygon",":first-child").attr("points",a.map(function(t){return t.x+","+t.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-r/2+","+e/2+")")}function mt(t,r){return t.intersect(r)}function at(t,r,e,a){var i=t.x,t=t.y,n=i-a.x,s=t-a.y,l=Math.sqrt(r*r*s*s+e*e*n*n),n=Math.abs(r*e*n/l),r=(a.x<i&&(n=-n),Math.abs(r*e*s/l));return{x:i+n,y:t+(r=a.y<t?-r:r)}}function kt(t,r,e){return at(t,r,r,e)}function Lt(t,r,e,a){var i,n,s,l,d=r.y-t.y,o=t.x-r.x,c=r.x*t.y-t.x*r.y,h=d*e.x+o*e.y+c,p=d*a.x+o*a.y+c;if(!(0!=h&&0!=p&&q(h,p)||(i=a.y-e.y,n=e.x-a.x,s=a.x*e.y-e.x*a.y,h=i*t.x+n*t.y+s,p=i*r.x+n*r.y+s,0!==h&&0!==p&&q(h,p)||0===(l=d*n-i*o))))return e=Math.abs(l/2),{x:(a=o*s-n*c)<0?(a-e)/l:(a+e)/l,y:(a=i*c-d*s)<0?(a-e)/l:(a+e)/l}}function q(t,r){return 0<t*r}function vt(t,r,a){var e=t.x,i=t.y,n=[],s=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY;"function"==typeof r.forEach?r.forEach(function(t){s=Math.min(s,t.x),l=Math.min(l,t.y)}):(s=Math.min(s,r.x),l=Math.min(l,r.y));for(var d=e-t.width/2-s,o=i-t.height/2-l,c=0;c<r.length;c++){var h=r[c],p=r[c<r.length-1?c+1:0],h=Lt(t,a,{x:d+h.x,y:o+h.y},{x:d+p.x,y:o+p.y});h&&n.push(h)}return n.length?(1<n.length&&n.sort(function(t,r){var e=t.x-a.x,t=t.y-a.y,e=Math.sqrt(e*e+t*t),t=r.x-a.x,r=r.y-a.y,t=Math.sqrt(t*t+r*r);return e<t?-1:e===t?0:1}),n[0]):t}const St=(t,r)=>{var e,a=t.x,i=t.y,n=r.x-a,r=r.y-i,s=t.width/2,t=t.height/2,t=Math.abs(r)*s>Math.abs(n)*t?(r<0&&(t=-t),e=0==r?0:t*n/r,t):(e=s=n<0?-s:s,0==n?0:s*r/n);return{x:a+e,y:i+t}},Et=St,m={node:mt,circle:kt,ellipse:at,polygon:vt,rect:Et},Bt=async(t,r)=>{r.useHtmlLabels||w().flowchart.htmlLabels||(r.centerLabel=!0);const{shapeSvg:e,bbox:a,halfPadding:i}=await B(t,r,"node "+r.classes,!0),n=(x.info("Classes = ",r.classes),e.insert("rect",":first-child"));return n.attr("rx",r.rx).attr("ry",r.ry).attr("x",-a.width/2-i).attr("y",-a.height/2-i).attr("width",a.width+r.padding).attr("height",a.height+r.padding),v(r,n),r.intersect=function(t){return m.rect(r,t)},e},Mt=Bt,J=t=>t?" "+t:"",T=(t,r)=>`${r||"node default"}${J(t.classes)} `+J(t.class),G=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=i+n,l=[{x:s/2,y:0},{x:s,y:-s/2},{x:s/2,y:-s},{x:0,y:-s/2}],d=(x.info("Question main (Circle)"),_(e,s,s,l));return d.attr("style",r.style),v(r,d),r.intersect=function(t){return x.warn("Intersect called"),m.polygon(r,l,t)},e},Ct=(t,r)=>{const e=t.insert("g").attr("class","node default").attr("id",r.domId||r.id),a=[{x:0,y:14},{x:14,y:0},{x:0,y:-14},{x:-14,y:0}];return e.insert("polygon",":first-child").attr("points",a.map(function(t){return t.x+","+t.y}).join(" ")).attr("class","state-start").attr("r",7).attr("width",28).attr("height",28),r.width=28,r.height=28,r.intersect=function(t){return m.circle(r,14,t)},e},Tt=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.height+r.padding,n=i/4,s=a.width+2*n+r.padding,l=[{x:n,y:0},{x:s-n,y:0},{x:s,y:-i/2},{x:s-n,y:-i},{x:n,y:-i},{x:0,y:-i/2}],d=_(e,s,i,l);return d.attr("style",r.style),v(r,d),r.intersect=function(t){return m.polygon(r,l,t)},e},Rt=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:-n/2,y:0},{x:i,y:0},{x:i,y:-n},{x:-n/2,y:-n},{x:0,y:-n/2}];return _(e,i,n,s).attr("style",r.style),r.width=i+n,r.height=n,r.intersect=function(t){return m.polygon(r,s,t)},e},It=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:-2*n/6,y:0},{x:i-n/6,y:0},{x:i+2*n/6,y:-n},{x:n/6,y:-n}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},Ht=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:2*n/6,y:0},{x:i+n/6,y:0},{x:i-2*n/6,y:-n},{x:-n/6,y:-n}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},Nt=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:-2*n/6,y:0},{x:i+2*n/6,y:0},{x:i-n/6,y:-n},{x:n/6,y:-n}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},$t=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:n/6,y:0},{x:i-n/6,y:0},{x:i+2*n/6,y:-n},{x:-2*n/6,y:-n}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},_t=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:0,y:0},{x:i+n/2,y:0},{x:i,y:-n/2},{x:i+n/2,y:-n},{x:0,y:-n}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},Wt=async(t,i)=>{const{shapeSvg:r,bbox:e}=await B(t,i,T(i,void 0),!0),a=e.width+i.padding,n=a/2,s=n/(2.5+a/50),l=e.height+s+i.padding,d="M 0,"+s+" a "+n+","+s+" 0,0,0 "+a+" 0 a "+n+","+s+" 0,0,0 "+-a+" 0 l 0,"+l+" a "+n+","+s+" 0,0,0 "+a+" 0 l 0,"+-l,o=r.attr("label-offset-y",s).insert("path",":first-child").attr("style",i.style).attr("d",d).attr("transform","translate("+-a/2+","+-(l/2+s)+")");return v(i,o),i.intersect=function(r){const e=m.rect(i,r),a=e.x-i.x;if(0!=n&&(Math.abs(a)<i.width/2||Math.abs(a)==i.width/2&&Math.abs(e.y-i.y)>i.height/2-s)){let t=s*s*(1-a*a/(n*n));0!=t&&(t=Math.sqrt(t)),t=s-t,0<r.y-i.y&&(t=-t),e.y+=t}return e},r},Xt=async(t,r)=>{const{shapeSvg:e,bbox:a,halfPadding:i}=await B(t,r,"node "+r.classes+" "+r.class,!0),n=e.insert("rect",":first-child"),s=a.width+r.padding,l=a.height+r.padding;if(n.attr("class","basic label-container").attr("style",r.style).attr("rx",r.rx).attr("ry",r.ry).attr("x",-a.width/2-i).attr("y",-a.height/2-i).attr("width",s).attr("height",l),r.props){const d=new Set(Object.keys(r.props));r.props.borders&&(et(n,r.props.borders,s,l),d.delete("borders")),d.forEach(t=>{x.warn("Unknown node property "+t)})}return v(r,n),r.intersect=function(t){return m.rect(r,t)},e},Yt=async(t,r)=>{const e=(await B(t,r,"label",!0))["shapeSvg"],a=(x.trace("Classes = ",r.class),e.insert("rect",":first-child"));if(a.attr("width",0).attr("height",0),e.attr("class","label edgeLabel"),r.props){const i=new Set(Object.keys(r.props));r.props.borders&&(et(a,r.props.borders,0,0),i.delete("borders")),i.forEach(t=>{x.warn("Unknown node property "+t)})}return v(r,a),r.intersect=function(t){return m.rect(r,t)},e};function et(t,r,e,a){const i=[],n=t=>{i.push(t,0)},s=t=>{i.push(0,t)};r.includes("t")?(x.debug("add top border"),n(e)):s(e),r.includes("r")?(x.debug("add right border"),n(a)):s(a),r.includes("b")?(x.debug("add bottom border"),n(e)):s(e),r.includes("l")?(x.debug("add left border"),n(a)):s(a),t.attr("stroke-dasharray",i.join(" "))}const At=(t,r)=>{let e;e=r.classes?"node "+r.classes:"node default";const a=t.insert("g").attr("class",e).attr("id",r.domId||r.id),i=a.insert("rect",":first-child"),n=a.insert("line"),s=a.insert("g").attr("class","label"),l=r.labelText.flat?r.labelText.flat():r.labelText;let d="";d="object"==typeof l?l[0]:l,x.info("Label text abc79",d,l,"object"==typeof l);const o=s.node().appendChild(I(d,r.labelStyle,!0,!0));let c={width:0,height:0};if(N(w().flowchart.htmlLabels)){const y=o.children[0],f=E(o);c=y.getBoundingClientRect(),f.attr("width",c.width),f.attr("height",c.height)}x.info("Text 2",l);const h=l.slice(1,l.length);var t=o.getBBox(),p=s.node().appendChild(I(h.join?h.join("<br/>"):h,r.labelStyle,!0,!0));if(N(w().flowchart.htmlLabels)){const b=p.children[0],u=E(p);c=b.getBoundingClientRect(),u.attr("width",c.width),u.attr("height",c.height)}var g=r.padding/2;return E(p).attr("transform","translate( "+(c.width>t.width?0:(t.width-c.width)/2)+", "+(t.height+g+5)+")"),E(o).attr("transform","translate( "+(c.width<t.width?0:-(t.width-c.width)/2)+", 0)"),c=s.node().getBBox(),s.attr("transform","translate("+-c.width/2+", "+(-c.height/2-g+3)+")"),i.attr("class","outer title-state").attr("x",-c.width/2-g).attr("y",-c.height/2-g).attr("width",c.width+r.padding).attr("height",c.height+r.padding),n.attr("class","divider").attr("x1",-c.width/2-g).attr("x2",c.width/2+g).attr("y1",-c.height/2-g+t.height+g).attr("y2",-c.height/2-g+t.height+g),v(r,i),r.intersect=function(t){return m.rect(r,t)},a},Ut=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.height+r.padding,n=a.width+i/4+r.padding,s=e.insert("rect",":first-child").attr("style",r.style).attr("rx",i/2).attr("ry",i/2).attr("x",-n/2).attr("y",-i/2).attr("width",n).attr("height",i);return v(r,s),r.intersect=function(t){return m.rect(r,t)},e},jt=async(t,r)=>{const{shapeSvg:e,bbox:a,halfPadding:i}=await B(t,r,T(r,void 0),!0),n=e.insert("circle",":first-child");return n.attr("style",r.style).attr("rx",r.rx).attr("ry",r.ry).attr("r",a.width/2+i).attr("width",a.width+r.padding).attr("height",a.height+r.padding),x.info("Circle main"),v(r,n),r.intersect=function(t){return x.info("Circle intersect",r,a.width/2+i,t),m.circle(r,a.width/2+i,t)},e},Dt=async(t,r)=>{const{shapeSvg:e,bbox:a,halfPadding:i}=await B(t,r,T(r,void 0),!0),n=e.insert("g",":first-child"),s=n.insert("circle"),l=n.insert("circle");return n.attr("class",r.class),s.attr("style",r.style).attr("rx",r.rx).attr("ry",r.ry).attr("r",a.width/2+i+5).attr("width",a.width+r.padding+10).attr("height",a.height+r.padding+10),l.attr("style",r.style).attr("rx",r.rx).attr("ry",r.ry).attr("r",a.width/2+i).attr("width",a.width+r.padding).attr("height",a.height+r.padding),x.info("DoubleCircle main"),v(r,s),r.intersect=function(t){return x.info("DoubleCircle intersect",r,a.width/2+i+5,t),m.circle(r,a.width/2+i+5,t)},e},Ot=async(t,r)=>{const{shapeSvg:e,bbox:a}=await B(t,r,T(r,void 0),!0),i=a.width+r.padding,n=a.height+r.padding,s=[{x:0,y:0},{x:i,y:0},{x:i,y:-n},{x:0,y:-n},{x:0,y:0},{x:-8,y:0},{x:i+8,y:0},{x:i+8,y:-n},{x:-8,y:-n},{x:-8,y:0}],l=_(e,i,n,s);return l.attr("style",r.style),v(r,l),r.intersect=function(t){return m.polygon(r,s,t)},e},zt=(t,r)=>{const e=t.insert("g").attr("class","node default").attr("id",r.domId||r.id),a=e.insert("circle",":first-child");return a.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),v(r,a),r.intersect=function(t){return m.circle(r,7,t)},e},K=(t,r,e)=>{const a=t.insert("g").attr("class","node default").attr("id",r.domId||r.id);let i=70,n=10;"LR"===e&&(i=10,n=70);t=a.append("rect").attr("x",-1*i/2).attr("y",-1*n/2).attr("width",i).attr("height",n).attr("class","fork-join");return v(r,t),r.height=r.height+r.padding/2,r.width=r.width+r.padding/2,r.intersect=function(t){return m.rect(r,t)},a},Zt=(t,r)=>{const e=t.insert("g").attr("class","node default").attr("id",r.domId||r.id),a=e.insert("circle",":first-child"),i=e.insert("circle",":first-child");return i.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),a.attr("class","state-end").attr("r",5).attr("width",10).attr("height",10),v(r,i),r.intersect=function(t){return m.circle(r,7,t)},e},Ft=(t,s)=>{const r=s.padding/2;let e;e=s.classes?"node "+s.classes:"node default";const a=t.insert("g").attr("class",e).attr("id",s.domId||s.id),i=a.insert("rect",":first-child"),n=a.insert("line"),l=a.insert("line");let d=0,o=4;const c=a.insert("g").attr("class","label");let h=0;const p=s.classData.annotations&&s.classData.annotations[0],g=s.classData.annotations[0]?"«"+s.classData.annotations[0]+"»":"",y=c.node().appendChild(I(g,s.labelStyle,!0,!0));let x=y.getBBox();if(N(w().flowchart.htmlLabels)){const L=y.children[0],B=E(y);x=L.getBoundingClientRect(),B.attr("width",x.width),B.attr("height",x.height)}s.classData.annotations[0]&&(o+=x.height+4,d+=x.width);let f=s.classData.label;void 0!==s.classData.type&&""!==s.classData.type&&(w().flowchart.htmlLabels?f+="&lt;"+s.classData.type+"&gt;":f+="<"+s.classData.type+">");const b=c.node().appendChild(I(f,s.labelStyle,!0,!0));E(b).attr("class","classTitle");let u=b.getBBox();if(N(w().flowchart.htmlLabels)){const T=b.children[0],M=E(b);u=T.getBoundingClientRect(),M.attr("width",u.width),M.attr("height",u.height)}o+=u.height+4,u.width>d&&(d=u.width);const k=[],S=(s.classData.members.forEach(t=>{t=V(t);let r=t.displayText;w().flowchart.htmlLabels&&(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const e=c.node().appendChild(I(r,t.cssStyle||s.labelStyle,!0,!0));let a=e.getBBox();if(N(w().flowchart.htmlLabels)){const i=e.children[0],n=E(e);a=i.getBoundingClientRect(),n.attr("width",a.width),n.attr("height",a.height)}a.width>d&&(d=a.width),o+=a.height+4,k.push(e)}),o+=8,[]);s.classData.methods.forEach(t=>{t=V(t);let r=t.displayText;w().flowchart.htmlLabels&&(r=r.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const e=c.node().appendChild(I(r,t.cssStyle||s.labelStyle,!0,!0));let a=e.getBBox();if(N(w().flowchart.htmlLabels)){const i=e.children[0],n=E(e);a=i.getBoundingClientRect(),n.attr("width",a.width),n.attr("height",a.height)}a.width>d&&(d=a.width),o+=a.height+4,S.push(e)}),o+=8,p&&(t=(d-x.width)/2,E(y).attr("transform","translate( "+(-1*d/2+t)+", "+-1*o/2+")"),h=x.height+4);t=(d-u.width)/2;return E(b).attr("transform","translate( "+(-1*d/2+t)+", "+(-1*o/2+h)+")"),h+=u.height+4,n.attr("class","divider").attr("x1",-d/2-r).attr("x2",d/2+r).attr("y1",-o/2-r+8+h).attr("y2",-o/2-r+8+h),h+=8,k.forEach(t=>{E(t).attr("transform","translate( "+-d/2+", "+(-1*o/2+h+4)+")");t=null==t?void 0:t.getBBox();h+=((null==t?void 0:t.height)??0)+4}),h+=8,l.attr("class","divider").attr("x1",-d/2-r).attr("x2",d/2+r).attr("y1",-o/2-r+8+h).attr("y2",-o/2-r+8+h),h+=8,S.forEach(t=>{E(t).attr("transform","translate( "+-d/2+", "+(-1*o/2+h)+")");t=null==t?void 0:t.getBBox();h+=((null==t?void 0:t.height)??0)+4}),i.attr("class","outer title-state").attr("x",-d/2-r).attr("y",-o/2-r).attr("width",d+s.padding).attr("height",o+s.padding),v(s,i),s.intersect=function(t){return m.rect(s,t)},a},P={rhombus:G,question:G,rect:Xt,labelRect:Yt,rectWithTitle:At,choice:Ct,circle:jt,doublecircle:Dt,stadium:Ut,hexagon:Tt,rect_left_inv_arrow:Rt,lean_right:It,lean_left:Ht,trapezoid:Nt,inv_trapezoid:$t,rect_right_inv_arrow:_t,cylinder:Wt,start:zt,end:Zt,note:Mt,subroutine:Ot,fork:K,join:K,class_box:Ft};let Y={};const tr=async(r,e,a)=>{let i,n;if(e.link){let t;"sandbox"===w().securityLevel?t="_top":e.linkTarget&&(t=e.linkTarget||"_blank"),i=r.insert("svg:a").attr("xlink:href",e.link).attr("target",t),n=await P[e.shape](i,e,a)}else n=await P[e.shape](r,e,a),i=n;return e.tooltip&&n.attr("title",e.tooltip),e.class&&n.attr("class","node default "+e.class),Y[e.id]=i,e.haveCallback&&Y[e.id].attr("class",Y[e.id].attr("class")+" clickable"),i},rr=(t,r)=>{Y[r.id]=t},ar=()=>{Y={}},er=t=>{const r=Y[t.id];x.trace("Transforming node",t.diff,t,"translate("+(t.x-t.width/2-5)+", "+t.width/2+")");var e=t.diff||0;return t.clusterNode?r.attr("transform","translate("+(t.x+e-t.width/2)+", "+(t.y-t.height/2-8)+")"):r.attr("transform","translate("+t.x+", "+t.y+")"),e};let D={},S={};const sr=()=>{D={},S={}},ir=(t,r)=>{const e=N(w().flowchart.htmlLabels),a="markdown"===r.labelType?rt(t,r.label,{style:r.labelStyle,useHtmlLabels:e,addSvgBackground:!0}):I(r.label,r.labelStyle),i=(x.info("abc82",r,r.labelType),t.insert("g").attr("class","edgeLabel")),n=i.insert("g").attr("class","label");n.node().appendChild(a);let s=a.getBBox();if(e){const o=a.children[0],c=E(a);s=o.getBoundingClientRect(),c.attr("width",s.width),c.attr("height",s.height)}n.attr("transform","translate("+-s.width/2+", "+-s.height/2+")"),D[r.id]=i,r.width=s.width,r.height=s.height;let l;if(r.startLabelLeft){const h=I(r.startLabelLeft,r.labelStyle),p=t.insert("g").attr("class","edgeTerminals"),g=p.insert("g").attr("class","inner");l=g.node().appendChild(h);var d=h.getBBox();g.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),S[r.id]||(S[r.id]={}),S[r.id].startLeft=p,j(l,r.startLabelLeft)}if(r.startLabelRight){const y=I(r.startLabelRight,r.labelStyle),f=t.insert("g").attr("class","edgeTerminals"),b=f.insert("g").attr("class","inner");l=f.node().appendChild(y),b.node().appendChild(y);d=y.getBBox();b.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),S[r.id]||(S[r.id]={}),S[r.id].startRight=f,j(l,r.startLabelRight)}if(r.endLabelLeft){const m=I(r.endLabelLeft,r.labelStyle),u=t.insert("g").attr("class","edgeTerminals"),k=u.insert("g").attr("class","inner");l=k.node().appendChild(m);d=m.getBBox();k.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),u.node().appendChild(m),S[r.id]||(S[r.id]={}),S[r.id].endLeft=u,j(l,r.endLabelLeft)}if(r.endLabelRight){const v=I(r.endLabelRight,r.labelStyle),L=t.insert("g").attr("class","edgeTerminals"),B=L.insert("g").attr("class","inner");l=B.node().appendChild(v);d=v.getBBox();B.attr("transform","translate("+-d.width/2+", "+-d.height/2+")"),L.node().appendChild(v),S[r.id]||(S[r.id]={}),S[r.id].endRight=L,j(l,r.endLabelRight)}return a};function j(t,r){w().flowchart.htmlLabels&&t&&(t.style.width=9*r.length+"px",t.style.height="12px")}const nr=(e,a)=>{x.info("Moving label abc78 ",e.id,e.label,D[e.id]);var i,n=a.updatedPath||a.originalPath;if(e.label){const s=D[e.id];let t=e.x,r=e.y;n&&(i=U.calcLabelPosition(n),x.info("Moving label "+e.label+" from (",t,",",r,") to (",i.x,",",i.y,") abc78"),a.updatedPath&&(t=i.x,r=i.y)),s.attr("transform","translate("+t+", "+r+")")}if(e.startLabelLeft){const l=S[e.id].startLeft;let t=e.x,r=e.y;n&&(a=U.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_left",n),t=a.x,r=a.y),l.attr("transform","translate("+t+", "+r+")")}if(e.startLabelRight){const d=S[e.id].startRight;let t=e.x,r=e.y;n&&(i=U.calcTerminalLabelPosition(e.arrowTypeStart?10:0,"start_right",n),t=i.x,r=i.y),d.attr("transform","translate("+t+", "+r+")")}if(e.endLabelLeft){const o=S[e.id].endLeft;let t=e.x,r=e.y;n&&(a=U.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_left",n),t=a.x,r=a.y),o.attr("transform","translate("+t+", "+r+")")}if(e.endLabelRight){const c=S[e.id].endRight;let t=e.x,r=e.y;n&&(i=U.calcTerminalLabelPosition(e.arrowTypeEnd?10:0,"end_right",n),t=i.x,r=i.y),c.attr("transform","translate("+t+", "+r+")")}},Qt=(t,r)=>{var e=t.x,a=t.y,e=Math.abs(r.x-e),r=Math.abs(r.y-a),a=t.width/2,t=t.height/2;return a<=e||t<=r},Vt=(a,i,n)=>{x.warn(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(i)}
  insidePoint : ${JSON.stringify(n)}
  node        : x:${a.x} y:${a.y} w:${a.width} h:`+a.height);var s=a.x,t=a.y,r=Math.abs(s-n.x),l=a.width/2;let d=n.x<i.x?l-r:l+r;var r=a.height/2,a=Math.abs(i.y-n.y),o=Math.abs(i.x-n.x);if(Math.abs(t-i.y)*l>Math.abs(s-i.x)*r){t=n.y<i.y?i.y-r-t:t-r-i.y;d=o*t/a;const e={x:n.x<i.x?n.x+d:n.x-o+d,y:n.y<i.y?n.y+a-t:n.y-a+t};return 0===d&&(e.x=i.x,e.y=i.y),0===o&&(e.x=i.x),0===a&&(e.y=i.y),x.warn(`abc89 topp/bott calc, Q ${a}, q ${t}, R ${o}, r `+d,e),e}{let t=a*(d=n.x<i.x?i.x-l-s:s-l-i.x)/o,r=n.x<i.x?n.x+o-d:n.x-o+d,e=n.y<i.y?n.y+t:n.y-t;return x.warn(`sides calc abc89, Q ${a}, q ${t}, R ${o}, r `+d,{_x:r,_y:e}),0===d&&(r=i.x,e=i.y),0===o&&(r=i.x),0===a&&(e=i.y),{x:r,y:e}}},tt=(t,a)=>{x.warn("abc88 cutPathAtIntersect",t,a);let i=[],n=t[0],s=!1;return t.forEach(t=>{if(x.info("abc88 checking point",t,a),Qt(a,t)||s)x.warn("abc88 outside",t,n),n=t,s||i.push(t);else{const e=Vt(a,n,t);x.warn("abc88 inside",t,n,e),x.warn("abc88 intersection",e);let r=!1;i.forEach(t=>{r=r||t.x===e.x&&t.y===e.y}),i.some(t=>t.x===e.x&&t.y===e.y)?x.warn("abc88 no intersect",e,i):i.push(e),s=!0}}),x.warn("abc88 returning points",i),i},lr=function(t,r,e,a,i,n){let s=e.points,l=!1;const d=n.node(r.v);n=n.node(r.w),x.info("abc88 InsertEdge: ",e),n.intersect&&d.intersect&&((s=s.slice(1,e.points.length-1)).unshift(d.intersect(s[0])),x.info("Last point",s[s.length-1],n,n.intersect(s[s.length-1])),s.push(n.intersect(s[s.length-1]))),e.toCluster&&(x.info("to cluster abc88",a[e.toCluster]),s=tt(e.points,a[e.toCluster].node),l=!0),e.fromCluster&&(x.info("from cluster abc88",a[e.fromCluster]),s=tt(s.reverse(),a[e.fromCluster].node).reverse(),l=!0),r=s.filter(t=>!Number.isNaN(t.y));let o;o=("graph"===i||"flowchart"===i)&&e.curve||Q;const c=it().x(function(t){return t.x}).y(function(t){return t.y}).curve(o);let h;switch(e.thickness){case"normal":h="edge-thickness-normal";break;case"thick":case"invisible":h="edge-thickness-thick";break;default:h=""}switch(e.pattern){case"solid":h+=" edge-pattern-solid";break;case"dotted":h+=" edge-pattern-dotted";break;case"dashed":h+=" edge-pattern-dashed"}const p=t.append("path").attr("d",c(r)).attr("id",e.id).attr("class"," "+h+(e.classes?" "+e.classes:"")).attr("style",e.style);let g="";switch((w().flowchart.arrowMarkerAbsolute||w().state.arrowMarkerAbsolute)&&(g=(g=(g=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search).replace(/\(/g,"\\(")).replace(/\)/g,"\\)")),x.info("arrowTypeStart",e.arrowTypeStart),x.info("arrowTypeEnd",e.arrowTypeEnd),e.arrowTypeStart){case"arrow_cross":p.attr("marker-start","url("+g+"#"+i+"-crossStart)");break;case"arrow_point":p.attr("marker-start","url("+g+"#"+i+"-pointStart)");break;case"arrow_barb":p.attr("marker-start","url("+g+"#"+i+"-barbStart)");break;case"arrow_circle":p.attr("marker-start","url("+g+"#"+i+"-circleStart)");break;case"aggregation":p.attr("marker-start","url("+g+"#"+i+"-aggregationStart)");break;case"extension":p.attr("marker-start","url("+g+"#"+i+"-extensionStart)");break;case"composition":p.attr("marker-start","url("+g+"#"+i+"-compositionStart)");break;case"dependency":p.attr("marker-start","url("+g+"#"+i+"-dependencyStart)");break;case"lollipop":p.attr("marker-start","url("+g+"#"+i+"-lollipopStart)")}switch(e.arrowTypeEnd){case"arrow_cross":p.attr("marker-end","url("+g+"#"+i+"-crossEnd)");break;case"arrow_point":p.attr("marker-end","url("+g+"#"+i+"-pointEnd)");break;case"arrow_barb":p.attr("marker-end","url("+g+"#"+i+"-barbEnd)");break;case"arrow_circle":p.attr("marker-end","url("+g+"#"+i+"-circleEnd)");break;case"aggregation":p.attr("marker-end","url("+g+"#"+i+"-aggregationEnd)");break;case"extension":p.attr("marker-end","url("+g+"#"+i+"-extensionEnd)");break;case"composition":p.attr("marker-end","url("+g+"#"+i+"-compositionEnd)");break;case"dependency":p.attr("marker-end","url("+g+"#"+i+"-dependencyEnd)");break;case"lollipop":p.attr("marker-end","url("+g+"#"+i+"-lollipopEnd)")}let y={};return l&&(y.updatedPath=s),y.originalPath=e.points,y};export{Pt as a,ar as b,I as c,sr as d,tr as e,ir as f,lr as g,nr as h,Et as i,B as l,er as p,rr as s,v as u};