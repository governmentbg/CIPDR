import{D as H,a as J,S as Q,b as X,c as Z,p as F,d as M,s as I}from"./styles-91bd061f.js";import{G as tt}from"./layout-df07420e.js";import{l as E,c as g,j as $,A as et,k as ot,f as w}from"./mermaid-d733041c.js";import{r as st}from"./index-c449e2c7.js";import"./edges-6be02a86.js";import"./createText-98e4790d.js";import"./svgDraw-8c7d5329.js";import"./line-b0ce4b23.js";import"./array-2ff2c7a6.js";import"./constant-2fe7eae5.js";const h="rect",C="rectWithTitle",nt="start",ct="end",it="divider",rt="roundedWithTitle",lt="note",at="noteGroup",_="statediagram",dt="state",Et=_+"-"+dt,U="transition",St="note",Tt="note-edge",pt=U+" "+Tt,_t=_+"-"+St,ut="cluster",ft=_+"-"+ut,Dt="cluster-alt",bt=_+"-"+Dt,V="parent",Y="note",At="state",N="----",ht=""+N+Y,v=""+N+V,W="fill:none",z="fill: #333",m="c",j="text",q="normal";let y={},d=0;const yt=function(t){for(const e of Object.keys(t))t[e]},gt=function(t,e){return e.db.extract(e.db.getRootDocV2()),e.db.getClasses()};function xt(t){return null!=t&&t.classes?t.classes.join(" "):""}function R(t="",e=0,s="",a=N){a=null!==s&&0<s.length?""+a+s:"";return At+`-${t}${a}-`+e}const A=(s,t,a,e,r,o)=>{var i=a.id,n=xt(e[i]);if("root"!==i){let t=h;!0===a.start&&(t=nt),!1===a.start&&(t=ct),a.type!==H&&(t=a.type),y[i]||(y[i]={id:i,shape:t,description:w.sanitizeText(i,g()),classes:n+" "+Et});const p=y[i],b=(a.description&&(Array.isArray(p.description)?(p.shape=C,p.description.push(a.description)):0<p.description.length?(p.shape=C,p.description===i?p.description=[a.description]:p.description=[p.description,a.description]):(p.shape=h,p.description=a.description),p.description=w.sanitizeTextOrArray(p.description,g())),1===p.description.length&&p.shape===C&&(p.shape=h),!p.type&&a.doc&&(E.info("Setting cluster for ",i,G(a)),p.type="group",p.dir=G(a),p.shape=a.type===J?it:rt,p.classes=p.classes+" "+ft+" "+(o?bt:"")),{labelStyle:"",shape:p.shape,labelText:p.description,classes:p.classes,style:"",id:i,dir:p.dir,domId:R(i,d),type:p.type,padding:15});if(b.centerLabel=!0,a.note){var n={labelStyle:"",shape:lt,labelText:a.note.text,classes:_t,style:"",id:i+ht+"-"+d,domId:R(i,d,Y),type:p.type,padding:15},l={labelStyle:"",shape:at,labelText:a.note.text,classes:p.classes,style:"",id:i+v,domId:R(i,d,V),type:"group",padding:0},c=(d++,i+v);s.setNode(c,l),s.setNode(n.id,n),s.setNode(i,b),s.setParent(i,c),s.setParent(n.id,c);let t=i,e=n.id;"left of"===a.note.position&&(t=n.id,e=i),s.setEdge(t,e,{arrowhead:"none",arrowType:"",style:W,labelStyle:"",classes:pt,arrowheadStyle:z,labelpos:m,labelType:j,thickness:q})}else s.setNode(i,b)}t&&"root"!==t.id&&(E.trace("Setting node ",i," to be child of its parent ",t.id),s.setParent(i,t.id)),a.doc&&(E.trace("Adding nodes children "),$t(s,a,a.doc,e,r,!o))},$t=(s,a,t,r,o,i)=>{E.trace("items",t),t.forEach(t=>{switch(t.stmt){case X:case H:A(s,a,t,r,o,i);break;case Q:A(s,a,t.state1,r,o,i),A(s,a,t.state2,r,o,i);var e={id:"edge"+d,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:W,labelStyle:"",label:w.sanitizeText(t.description,g()),arrowheadStyle:z,labelpos:m,labelType:j,thickness:q,classes:U};s.setEdge(t.state1.id,t.state2.id,e,d),d++}})},G=(e,t=Z)=>{let s=t;if(e.doc)for(let t=0;t<e.doc.length;t++){var a=e.doc[t];"dir"===a.stmt&&(s=a.value)}return s},Ct=async function(t,e,s,a){E.info("Drawing state diagram (v2)",e),y={},a.db.getDirection();var{securityLevel:r,state:o}=g(),i=o.nodeSpacing||50,d=o.rankSpacing||50,n=(E.info(a.db.getRootDocV2()),a.db.extract(a.db.getRootDocV2()),E.info(a.db.getRootDocV2()),a.db.getStates()),i=new tt({multigraph:!0,compound:!0}).setGraph({rankdir:G(a.db.getRootDocV2()),nodesep:i,ranksep:d,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});A(i,void 0,a.db.getRootDocV2(),n,a.db,!0);let l;"sandbox"===r&&(l=$("#i"+e));const c=$("sandbox"===r?l.nodes()[0].contentDocument.body:"body"),p=c.select(`[id="${e}"]`),b=c.select("#"+e+" g");await st(b,i,["barb"],_,e);et.insertTitle(p,"statediagramTitleText",o.titleTopMargin,a.db.getDiagramTitle());d=p.node().getBBox(),n=d.width+16,r=d.height+16,p.attr("class",_),i=p.node().getBBox(),ot(p,r,n,o.useMaxWidth),a=`${i.x-8} ${i.y-8} ${n} `+r,E.debug("viewBox "+a),p.attr("viewBox",a),d=document.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(const f of d){const u=f.getBBox(),m=document.createElementNS("http://www.w3.org/2000/svg",h);m.setAttribute("rx",0),m.setAttribute("ry",0),m.setAttribute("width",u.width),m.setAttribute("height",u.height),f.insertBefore(m,f.firstChild)}},Rt={setConf:yt,getClasses:gt,draw:Ct},Ht={parser:F,db:M,renderer:Rt,styles:I,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,M.clear()}};export{Ht as diagram};