import{G as Graph}from"./layout-7899ed33.js";import{S as Selection,v as root,x as array,_,C as Color,y as isPlainObject,z as isFunction,p as getStylesFromArray,l as log,q as evaluate,c as getConfig,f as common,r as interpolateToCurve,o as curveLinear,j as d3select,A as utils,t as setupGraphViewbox,B as rgba}from"./mermaid-f185fde2.js";import{r as render}from"./index-1bb7dfb9.js";function selectAll(e){return"string"==typeof e?new Selection([document.querySelectorAll(e)],[document.documentElement]):new Selection([array(e)],root)}const channel=(e,t)=>_.lang.round(Color.parse(e)[t]),channel$1=channel;function isSubgraph(e,t){return!!e.children(t).length}function edgeToId(e){return escapeId(e.v)+":"+escapeId(e.w)+":"+escapeId(e.name)}var ID_DELIM=/:/g;function escapeId(e){return e?String(e).replace(ID_DELIM,"\\:"):""}function applyStyle(e,t){t&&e.attr("style",t)}function applyClass(e,t,r){t&&e.attr("class",t).attr("class",r+" "+e.attr("class"))}function applyTransition(e,t){t=t.graph();if(isPlainObject(t)){t=t.transition;if(isFunction(t))return t(e)}return e}function addHtmlLabel(e,t){var e=e.append("foreignObject").attr("width","100000"),r=e.append("xhtml:div"),l=(r.attr("xmlns","http://www.w3.org/1999/xhtml"),t.label);switch(typeof l){case"function":r.insert(l);break;case"object":r.insert(function(){return l});break;default:r.html(l)}applyStyle(r,t.labelStyle),r.style("display","inline-block"),r.style("white-space","nowrap");t=r.node().getBoundingClientRect();return e.attr("width",t.width).attr("height",t.height),e}const conf={},setConf=function(e){for(const t of Object.keys(e))conf[t]=e[t]},addVertices=function(p,b,e,t,g,u){const f=t.select(`[id="${e}"]`),r=Object.keys(p);r.forEach(function(e){const t=p[e];let r="default";0<t.classes.length&&(r=t.classes.join(" ")),r+=" flowchart-label";const l=getStylesFromArray(t.styles);let a=void 0!==t.text?t.text:t.id,o;if(log.info("vertex",t,t.labelType),"markdown"===t.labelType)log.info("vertex",t,t.labelType);else if(evaluate(getConfig().flowchart.htmlLabels)){e={label:a.replace(/fa[blrs]?:fa-[\w-]+/g,e=>`<i class='${e.replace(":"," ")}'></i>`)};(o=addHtmlLabel(f,e).node()).parentNode.removeChild(o)}else{const i=g.createElementNS("http://www.w3.org/2000/svg","text");i.setAttribute("style",l.labelStyle.replace("color:","fill:"));for(const d of a.split(common.lineBreakRegex)){const c=g.createElementNS("http://www.w3.org/2000/svg","tspan");c.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),c.setAttribute("dy","1em"),c.setAttribute("x","1"),c.textContent=d,i.appendChild(c)}o=i}let n=0,s="";switch(t.type){case"round":n=5,s="rect";break;case"square":s="rect";break;case"diamond":s="question";break;case"hexagon":s="hexagon";break;case"odd":s="rect_left_inv_arrow";break;case"lean_right":s="lean_right";break;case"lean_left":s="lean_left";break;case"trapezoid":s="trapezoid";break;case"inv_trapezoid":s="inv_trapezoid";break;case"odd_right":s="rect_left_inv_arrow";break;case"circle":s="circle";break;case"ellipse":s="ellipse";break;case"stadium":s="stadium";break;case"subroutine":s="subroutine";break;case"cylinder":s="cylinder";break;case"group":s="rect";break;case"doublecircle":s="doublecircle";break;default:s="rect"}b.setNode(t.id,{labelStyle:l.labelStyle,shape:s,labelText:a,labelType:t.labelType,rx:n,ry:n,class:r,style:l.style,id:t.id,link:t.link,linkTarget:t.linkTarget,tooltip:u.db.getTooltip(t.id)||"",domId:u.db.lookUpDomId(t.id),haveCallback:t.haveCallback,width:"group"===t.type?500:void 0,dir:t.dir,type:t.type,props:t.props,padding:getConfig().flowchart.padding}),log.info("setNode",{labelStyle:l.labelStyle,labelType:t.labelType,shape:s,labelText:a,rx:n,ry:n,class:r,style:l.style,id:t.id,domId:u.db.lookUpDomId(t.id),width:"group"===t.type?500:void 0,type:t.type,dir:t.dir,props:t.props,padding:getConfig().flowchart.padding})})},addEdges=function(i,d,e){log.info("abc78 edges = ",i);let c=0,p={},b,g;var t;void 0!==i.defaultStyle&&(t=getStylesFromArray(i.defaultStyle),b=t.style,g=t.labelStyle),i.forEach(function(e){c++;var t,r="L-"+e.start+"-"+e.end,l=(void 0===p[r]?p[r]=0:p[r]++,log.info("abc78 new entry",r,p[r]),r+"-"+p[r]),r=(log.info("abc78 new link id to be used is",r,l,p[r]),"LS-"+e.start),a="LE-"+e.end;const o={style:"",labelStyle:""};switch(o.minlen=e.length||1,"arrow_open"===e.type?o.arrowhead="none":o.arrowhead="normal",o.arrowTypeStart="arrow_open",o.arrowTypeEnd="arrow_open",e.type){case"double_arrow_cross":o.arrowTypeStart="arrow_cross";case"arrow_cross":o.arrowTypeEnd="arrow_cross";break;case"double_arrow_point":o.arrowTypeStart="arrow_point";case"arrow_point":o.arrowTypeEnd="arrow_point";break;case"double_arrow_circle":o.arrowTypeStart="arrow_circle";case"arrow_circle":o.arrowTypeEnd="arrow_circle"}let n="",s="";switch(e.stroke){case"normal":n="fill:none;",void 0!==b&&(n=b),void 0!==g&&(s=g),o.thickness="normal",o.pattern="solid";break;case"dotted":o.thickness="normal",o.pattern="dotted",o.style="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":o.thickness="thick",o.pattern="solid",o.style="stroke-width: 3.5px;fill:none;";break;case"invisible":o.thickness="invisible",o.pattern="solid",o.style="stroke-width: 0;fill:none;"}void 0!==e.style&&(t=getStylesFromArray(e.style),n=t.style,s=t.labelStyle),o.style=o.style+=n,o.labelStyle=o.labelStyle+=s,void 0!==e.interpolate?o.curve=interpolateToCurve(e.interpolate,curveLinear):void 0!==i.defaultInterpolate?o.curve=interpolateToCurve(i.defaultInterpolate,curveLinear):o.curve=interpolateToCurve(conf.curve,curveLinear),void 0===e.text?void 0!==e.style&&(o.arrowheadStyle="fill: #333"):(o.arrowheadStyle="fill: #333",o.labelpos="c"),o.labelType=e.labelType,o.label=e.text.replace(common.lineBreakRegex,"\n"),void 0===e.style&&(o.style=o.style||"stroke: #333; stroke-width: 1.5px;fill:none;"),o.labelStyle=o.labelStyle.replace("color:","fill:"),o.id=l,o.classes="flowchart-link "+r+" "+a,d.setEdge(e.start,e.end,o,c)})},getClasses=function(e,t){return t.db.getClasses()},draw=async function(e,s,t,r){log.info("Drawing flowchart");let l=r.db.getDirection();void 0===l&&(l="TD");const{securityLevel:i,flowchart:a}=getConfig();var o=a.nodeSpacing||50,n=a.rankSpacing||50;let d;"sandbox"===i&&(d=d3select("#i"+s));const c="sandbox"===i?d3select(d.nodes()[0].contentDocument.body):d3select("body"),p="sandbox"===i?d.nodes()[0].contentDocument:document,b=new Graph({multigraph:!0,compound:!0}).setGraph({rankdir:l,nodesep:o,ranksep:n,marginx:0,marginy:0}).setDefaultEdgeLabel(function(){return{}});let g;var u=r.db.getSubGraphs();log.info("Subgraphs - ",u);for(let e=u.length-1;0<=e;e--)g=u[e],log.info("Subgraph - ",g),r.db.addVertex(g.id,{text:g.title,type:g.labelType},"group",void 0,g.classes,g.dir);const f=r.db.getVertices();o=r.db.getEdges();log.info("Edges",o);let w=0;for(w=u.length-1;0<=w;w--){g=u[w],selectAll("cluster").append("text");for(let e=0;e<g.nodes.length;e++)log.info("Setting up subgraphs",g.nodes[e],g.id),b.setParent(g.nodes[e],g.id)}addVertices(f,b,s,c,p,r),addEdges(o,b);n=c.select(`[id="${s}"]`),o=c.select("#"+s+" g");if(await render(o,b,["point","circle","cross"],"flowchart",s),utils.insertTitle(n,"flowchartTitleText",a.titleTopMargin,r.db.getDiagramTitle()),setupGraphViewbox(b,n,a.diagramPadding,a.useMaxWidth),r.db.indexNodes("subGraph"+w),!a.htmlLabels)for(const k of p.querySelectorAll('[id="'+s+'"] .edgeLabel .label')){var h=k.getBBox();const m=p.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("rx",0),m.setAttribute("ry",0),m.setAttribute("width",h.width),m.setAttribute("height",h.height),k.insertBefore(m,k.firstChild)}const y=Object.keys(f);y.forEach(function(e){const t=f[e];if(t.link){const r=d3select("#"+s+' [id="'+e+'"]');if(r){const l=p.createElementNS("http://www.w3.org/2000/svg","a"),a=(l.setAttributeNS("http://www.w3.org/2000/svg","class",t.classes.join(" ")),l.setAttributeNS("http://www.w3.org/2000/svg","href",t.link),l.setAttributeNS("http://www.w3.org/2000/svg","rel","noopener"),"sandbox"===i?l.setAttributeNS("http://www.w3.org/2000/svg","target","_top"):t.linkTarget&&l.setAttributeNS("http://www.w3.org/2000/svg","target",t.linkTarget),r.insert(function(){return l},":first-child")),o=r.select(".label-container"),n=(o&&a.append(function(){return o.node()}),r.select(".label"));n&&a.append(function(){return n.node()})}}})},flowRendererV2={setConf:setConf,addVertices:addVertices,addEdges:addEdges,getClasses:getClasses,draw:draw},fade=(e,t)=>{const r=channel$1;var l=r(e,"r"),a=r(e,"g"),e=r(e,"b");return rgba(l,a,e,t)},getStyles=e=>`.label {
    font-family: ${e.fontFamily};
    color: ${e.nodeTextColor||e.textColor};
  }
  .cluster-label text {
    fill: ${e.titleColor};
  }
  .cluster-label span,p {
    color: ${e.titleColor};
  }

  .label text,span,p {
    fill: ${e.nodeTextColor||e.textColor};
    color: ${e.nodeTextColor||e.textColor};
  }

  .node rect,
  .node circle,
  .node ellipse,
  .node polygon,
  .node path {
    fill: ${e.mainBkg};
    stroke: ${e.nodeBorder};
    stroke-width: 1px;
  }
  .flowchart-label text {
    text-anchor: middle;
  }
  // .flowchart-label .text-outer-tspan {
  //   text-anchor: middle;
  // }
  // .flowchart-label .text-inner-tspan {
  //   text-anchor: start;
  // }

  .node .label {
    text-align: center;
  }
  .node.clickable {
    cursor: pointer;
  }

  .arrowheadPath {
    fill: ${e.arrowheadColor};
  }

  .edgePath .path {
    stroke: ${e.lineColor};
    stroke-width: 2.0px;
  }

  .flowchart-link {
    stroke: ${e.lineColor};
    fill: none;
  }

  .edgeLabel {
    background-color: ${e.edgeLabelBackground};
    rect {
      opacity: 0.5;
      background-color: ${e.edgeLabelBackground};
      fill: ${e.edgeLabelBackground};
    }
    text-align: center;
  }

  /* For html labels only */
  .labelBkg {
    background-color: ${fade(e.edgeLabelBackground,.5)};
    // background-color: 
  }

  .cluster rect {
    fill: ${e.clusterBkg};
    stroke: ${e.clusterBorder};
    stroke-width: 1px;
  }

  .cluster text {
    fill: ${e.titleColor};
  }

  .cluster span,p {
    color: ${e.titleColor};
  }
  /* .cluster div {
    color: ${e.titleColor};
  } */

  div.mermaidTooltip {
    position: absolute;
    text-align: center;
    max-width: 200px;
    padding: 2px;
    font-family: ${e.fontFamily};
    font-size: 12px;
    background: ${e.tertiaryColor};
    border: 1px solid ${e.border2};
    border-radius: 2px;
    pointer-events: none;
    z-index: 100;
  }

  .flowchartTitleText {
    text-anchor: middle;
    font-size: 18px;
    fill: ${e.textColor};
  }
`,flowStyles=getStyles;export{applyStyle as a,addHtmlLabel as b,applyTransition as c,applyClass as d,edgeToId as e,flowRendererV2 as f,flowStyles as g,isSubgraph as i,selectAll as s};