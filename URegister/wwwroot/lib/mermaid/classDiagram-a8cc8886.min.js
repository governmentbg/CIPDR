import{p as parser,d as db,s as styles}from"./styles-622362e4.js";import{select}from"d3";import{layout}from"dagre-d3-es/src/dagre/index.js";import*as graphlib from"dagre-d3-es/src/graphlib/index.js";import{c as getConfig,l as log,i as configureSvgSize}from"./mermaid-768dc893.js";import{s as svgDraw}from"./svgDraw-70101091.js";import"ts-dedent";import"dayjs";import"@braintree/sanitize-url";import"dompurify";import"khroma";import"lodash-es/memoize.js";import"lodash-es/merge.js";import"stylis";import"lodash-es/isEmpty.js";let idCache={};const padding=20,getGraphId=function(e){var t=Object.entries(idCache).find(t=>t[1].label===e);if(t)return t[0]},insertMarkers=function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},draw=function(t,e,r,a){const d=getConfig().class;idCache={},log.info("Rendering diagram "+t);t=getConfig().securityLevel;let i;"sandbox"===t&&(i=select("#i"+e));const n=select("sandbox"===t?i.nodes()[0].contentDocument.body:"body"),o=n.select(`[id='${e}']`),s=(insertMarkers(o),new graphlib.Graph({multigraph:!0})),p=(s.setGraph({isMultiGraph:!0}),s.setDefaultEdgeLabel(function(){return{}}),a.db.getClasses());for(const f of Object.keys(p)){var g=p[f],g=svgDraw.drawClass(o,g,d,a);idCache[g.id]=g,s.setNode(g.id,g),log.info("Org height: "+g.height)}const l=a.db.getRelations(),h=(l.forEach(function(t){log.info("tjoho"+getGraphId(t.id1)+getGraphId(t.id2)+JSON.stringify(t)),s.setEdge(getGraphId(t.id1),getGraphId(t.id2),{relation:t},t.title||"DEFAULT")}),a.db.getNotes());h.forEach(function(t){log.debug("Adding note: "+JSON.stringify(t));var e=svgDraw.drawNote(o,t,d,a);idCache[e.id]=e,s.setNode(e.id,e),t.class&&t.class in p&&s.setEdge(t.id,getGraphId(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")}),layout(s),s.nodes().forEach(function(t){void 0!==t&&void 0!==s.node(t)&&(log.debug("Node "+t+": "+JSON.stringify(s.node(t))),n.select("#"+(a.db.lookUpDomId(t)||t)).attr("transform","translate("+(s.node(t).x-s.node(t).width/2)+","+(s.node(t).y-s.node(t).height/2)+" )"))}),s.edges().forEach(function(t){void 0!==t&&void 0!==s.edge(t)&&(log.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(s.edge(t))),svgDraw.drawEdge(o,s.edge(t),s.edge(t).relation,d,a))});var t=o.node().getBBox(),e=t.width+2*padding,m=t.height+2*padding,t=(configureSvgSize(o,m,e,d.useMaxWidth),`${t.x-padding} ${t.y-padding} ${e} `+m);log.debug("viewBox "+t),o.attr("viewBox",t)},renderer={draw:draw},diagram={parser:parser,db:db,renderer:renderer,styles:styles,init:t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,db.clear()}};export{diagram};